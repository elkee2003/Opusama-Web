enum VendorTransactionType {
  CREDIT    # Money credited to vendor balance (after booking completion)
  PAYOUT    # Money sent to vendor's bank account
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

type VendorBalance @model @auth(rules: [{ allow: public }]) {
  id: ID!
  realtorID: ID! @index(name: "byRealtor")
  totalEarned: Float!         # All money credited from completed bookings
  totalPaid: Float!           # How much has been transferred out to the realtor
  pendingBalance: Float!      # totalEarned - totalPaid
  lastPayoutDate: AWSDateTime # Last time a payout was made

  Realtor: Realtor @belongsTo(fields: ["realtorID"])
  VendorTransactions: [VendorTransaction] @hasMany(indexName: "byVendorBalance", fields: ["id"])
}

# ðŸ’° Transaction log for each booking or payout event
type VendorTransaction @model @auth(rules: [{ allow: public }]) {
  id: ID!
  vendorBalanceID: ID! @index(name: "byVendorBalance")
  realtorID: ID! @index(name: "byRealtor")
  bookingID: ID! @index(name: "byBooking")
  type: VendorTransactionType!
  amount: Float!
  status: TransactionStatus!
  createdAt: AWSDateTime
  updatedAt: AWSDateTime

  # Relationships
  VendorBalance: VendorBalance @belongsTo(fields: ["vendorBalanceID"])
  Realtor: Realtor @belongsTo(fields: ["realtorID"])
  Booking: Booking @belongsTo(fields: ["bookingID"])
}

type Notification @model @auth(rules: [{allow: public}]) {
  id: ID!
  creatorID: String
  recipientID: String
  recipientType: String
  type: String
  entityID: String
  commentID: String
  message: String
  read: Boolean
}

type CommunityLike @model @auth(rules: [{allow: public}]) {
  id: ID!
  like: Boolean
  likedByID: String
  communitydiscussionID: ID! @index(name: "byCommunityDiscussion")
}

type CommunityReply @model @auth(rules: [{allow: public}]) {
  id: ID!
  comment: String
  media: [String]
  commenterID: String
  communitydiscussionID: ID! @index(name: "byCommunityDiscussion")
}

type CommunityDiscussion @model @auth(rules: [{allow: public}]) {
  id: ID!
  category: String
  title: String
  content: String
  instigatorID: String
  media: [String]
  CommunityReplies: [CommunityReply] @hasMany(indexName: "byCommunityDiscussion", fields: ["id"])
  CommunityLikes: [CommunityLike] @hasMany(indexName: "byCommunityDiscussion", fields: ["id"])
}

enum BookingStatus {
  PENDING
  ACCEPTED
  VIEWING
  CHECKED_IN
  VISITING
  VIEWED
  CHECKED_OUT
  VISITED
  SOLD
  PAID
  DELAYED_PAYMENT
  RECEIVED
  DENIED
  OCCUPIED
  REMOVED_CLIENT
  REMOVED_REALTOR
  REMOVED_REALTOR_PAYMENT_DELAYED
}

type PostComment @model @auth(rules: [{allow: public}]) {
  id: ID!
  comment: String
  commenterID: String
  realtorID: String
  postID: ID! @index(name: "byPost")
}

type PostLike @model @auth(rules: [{allow: public}]) {
  id: ID!
  like: Boolean
  likedByID: String
  postID: ID! @index(name: "byPost")
}

type RealtorReview @model @auth(rules: [{allow: public}]) {
  id: ID!
  rating: Float
  review: String
  realtorID: ID! @index(name: "byRealtor")
  userID: ID! @index(name: "byUser")
}

type PostReview @model @auth(rules: [{allow: public}]) {
  id: ID!
  rating: Float
  review: String
  realtorID: String
  postID: ID! @index(name: "byPost")
  userID: ID! @index(name: "byUser")
}

type Booking @model @auth(rules: [{allow: public}]) {
  id: ID!
  opusingFor: String
  otherUsername: String
  opusedBy: String
  adults: Int
  kids: Int
  infants: Int
  numberOfPeople: Int
  numberOfItems: Int
  clientFirstName: String
  clientLastName: String
  clientPhoneNumber: String
  guestEmail: String
  purpose: String
  selectedOption: AWSJSON
  duration: String
  checkInDate: String
  checkOutDate: String
  bookedSessionDuration: String
  subscription: Boolean
  propertyType: String
  accommodationType: String
  nameOfType: String
  totalPrice: Float
  realtorPrice: Float
  opusamaCommission: Float
  serviceCharge: Float
  overAllPrice: Float
  bookingLat: Float
  bookingLng: Float
  status: BookingStatus
  userID: ID! @index(name: "byUser")
  transactionReference: String
  transactionStatus: String
  realtorID: ID! @index(name: "byRealtor")
  paymentRecordID: ID @index(name: "byPaymentRecord")
  PostID: String
  ticketID: String
  qrCodeUrl: String
  ticketStatus: String
  checkedInByID: String

  # ðŸ†• Link to VendorTransaction
  VendorTransactions: [VendorTransaction] @hasMany(indexName: "byBooking", fields: ["id"])
}

type User @model @auth(rules: [{allow: public}]) {
  id: ID!
  sub: String!
  firstName: String!
  lastName: String
  username: String
  email: String
  isVerified: Boolean
  profilePic: String
  PostReviews: [PostReview] @hasMany(indexName: "byUser", fields: ["id"])
  RealtorReviews: [RealtorReview] @hasMany(indexName: "byUser", fields: ["id"])
  phoneNumber: String
  Bookings: [Booking] @hasMany(indexName: "byUser", fields: ["id"])
  address: String
  cardNumber: String
  cardExpiry: String
  cardCvv: String
  push_token: String
}

type VendorScanner @model @auth(rules: [{allow: public}]) {
  id: ID!
  vendorID: String
  name: String
  token: String
  expiresAt: String
  isActive: Boolean
}

type Realtor @model @auth(rules: [{allow: public}]) {
  id: ID!
  sub: String!
  firstName: String
  lastName: String
  username: String
  myDescription: String
  profilePic: String
  email: String
  address: String
  phoneNumber: String
  bankName: String
  bankCode: String
  accountName: String
  accountNumber: String
  directPayment: Boolean
  push_token: String
  isVerified: Boolean
  isPartner: Boolean
  isPremium: Boolean
  isElite: Boolean
  isTrusted: Boolean

  Post: [Post] @hasMany(indexName: "byRealtor", fields: ["id"])
  Bookings: [Booking] @hasMany(indexName: "byRealtor", fields: ["id"])
  RealtorReview: [RealtorReview] @hasMany(indexName: "byRealtor", fields: ["id"])
  

   # ðŸ†• New relationships for payments
  VendorBalance: VendorBalance @hasOne(fields: ["id"])
  VendorTransactions: [VendorTransaction] @hasMany(indexName: "byRealtor", fields: ["id"])
}

enum PickUpStatus {
  PENDING
  PREPARING
  READY
  PICKED_UP
}

enum BookingPostOptionType {
  RESERVATION
  VOUCHER
  PICKUP
}

type BookingPostOptions @model @auth(rules: [{allow: public}]) {
  id: ID!
  postID: ID! @index(name: "byPost")
  bookingPostOptionType: BookingPostOptionType
  bookingName: String
  optionPrice: Float
  minSpend: Float
  pickupStatus: PickUpStatus
}

type Post @model @auth(rules: [{allow: public}]) {
  id: ID!
  propertyType: String!
  type: String!
  nameOfType: String
  packageType: String
  availableDocs: String
  accommodationParts: String
  media: [String]
  description: String!
  eventName: String
  eventDateTime: String
  eventEndDateTime: String
  recurrence: String
  eventFrequency: String
  capacity: String
  dressCode: String
  available: Boolean
  address: String
  fullAddress: String
  PostReviews: [PostReview] @hasMany(indexName: "byPost", fields: ["id"])
  generalLocation: String
  lat: Float
  lng: Float
  price: Float
  cautionFee: Float
  totalPrice: Float!
  inspectionFee: Float
  otherFeesName: String
  otherFeesPrice: Float
  otherFeesName2: String
  otherFeesPrice2: Float
  vendorCommissionAmount: Float
  PostComments: [PostComment] @hasMany(indexName: "byPost", fields: ["id"])
  vendorCommissionBreakdown: AWSJSON
  clientServiceFee: Float
  timeFrame: String
  bed: String
  bedrooms: String
  amenities: String
  PostLikes: [PostLike] @hasMany(indexName: "byPost", fields: ["id"])
  policies: String
  country: String!
  state: String
  city: String
  isApproved: Boolean
  isSubscription: Boolean
  bookingMode: String
  allowMultiple: Boolean
  maxCapacity: Int
  sessionDuration: Int
  sessionGap: Int
  servicingDay: [String]
  BookingPostOptions: [BookingPostOptions] @hasMany(indexName: "byPost", fields: ["id"])
  openingHour: String
  closingHour: String
  realtorID: ID! @index(name: "byRealtor")
}
 